<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
<head>
    <title>Step 2: The Service with Re-ranking logic</title>
    <style type="text/css" media="screen">
		@import url( ../shared/style.css );
	</style>
	<script src="../shared/scormfunctions.js" type="text/javascript"></script>
	<script src="../shared/contentfunctions.js" type="text/javascript"></script>
</head>
<body>
<h1>Step 2: The Service with Re-ranking logic</h1>

<p>To ensure the model isn&#x27;t overwhelmed by &quot;noise&quot; from the web or internal docs, we implement a <strong>DocumentPostProcessor</strong> for re-ranking.</p>

<p>Java</p>

<p>@Service</p>

<p>public class AdvancedRagService {</p>

<p>    private final ChatClient chatClient;</p>

<p>    public AdvancedRagService(ChatClient.Builder builder, VectorStore vectorStore) {</p>

<p>        // 1. Setup the Multi-step Retriever with a Re-ranker</p>

<p>        var retrievalAdvisor = RetrievalAugmentationAdvisor.builder()</p>

<p>            .documentRetriever(VectorStoreDocumentRetriever.builder()</p>

<p>                .vectorStore(vectorStore)</p>

<p>                .topK(15) // Get a wide pool first</p>

<p>                .build())</p>

<p>            .documentPostProcessors(List.of((query, docs) -&gt; {</p>

<p>                // Here you would integrate a model like Cohere Rerank</p>

<p>                // For now, we simulate a &#x27;Two-Stage&#x27; filter</p>

<p>                return docs.stream().limit(5).toList(); </p>

<p>            }))</p>

<p>            .build();</p>

<p>        // 2. Build the Agentic ChatClient</p>

<p>        this.chatClient = builder</p>

<p>            .defaultAdvisors(</p>

<p>                retrievalAdvisor, // Internal RAG</p>

<p>                new ToolCallAdvisor(List.of(&quot;webSearch&quot;)) // Web Tool</p>

<p>            )</p>

<p>            .build();</p>

<p>    }</p>

<p>    public String execute(String userPrompt) {</p>

<p>        return this.chatClient.prompt()</p>

<p>            .user(userPrompt)</p>

<p>            .call()</p>

<p>            .content();</p>

<p>    }</p>

<p>}</p>

<script type="text/javascript">
</script>
</body>
</html>