<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
<head>
    <title>Chart Recommendation and Dashboards</title>
    <style type="text/css" media="screen">
		@import url( ../shared/style.css );
	</style>
	<script src="../shared/scormfunctions.js" type="text/javascript"></script>
	<script src="../shared/contentfunctions.js" type="text/javascript"></script>
</head>
<body>
<h1>Chart Recommendation and Dashboards</h1>


<h2>AI-Powered Chart Recommendation</h2>
<p>After generating SQL results, an LLM can recommend the best visualization type and generate chart configurations automatically:</p>
<div class="code-block">
<pre><code>def recommend_chart(question: str, sql_result: dict, columns: list) -&gt; dict:
    '''Use an LLM to recommend the best chart type for query results.'''
    response = client.chat.completions.create(
        model="gpt-4o-mini",
        response_format={"type": "json_object"},
        messages=[{
            "role": "system",
            "content": (
                "You are a data visualization expert. Given a question and query results, "
                "recommend the best chart type and configuration. "
                "Return JSON: {"chart_type": str, "x_axis": str, "y_axis": str, "
                ""color_by": str|null, "title": str, "insights": [str]}"
            ),
        }, {
            "role": "user",
            "content": (
                f"Question: {question}
"
                f"Columns: {columns}
"
                f"Sample data (first 5 rows): {json.dumps(sql_result[:5])}
"
                f"Total rows: {len(sql_result)}"
            ),
        }],
    )
    return json.loads(response.choices[0].message.content)

# Example output:
# {
#   "chart_type": "bar",
#   "x_axis": "category",
#   "y_axis": "revenue",
#   "color_by": null,
#   "title": "Top Product Categories by Revenue (2025)",
#   "insights": [
#     "Electronics leads with 2x the revenue of the second category",
#     "The top 3 categories account for 70% of total revenue"
#   ]
# }</code></pre>
</div>

<h2>Chart Type Selection Guide</h2>
<table>
    <tr><th>Data Pattern</th><th>Recommended Chart</th><th>Example Question</th></tr>
    <tr><td>Categories with values</td><td>Bar chart</td><td>"Revenue by region"</td></tr>
    <tr><td>Trends over time</td><td>Line chart</td><td>"Monthly active users this year"</td></tr>
    <tr><td>Proportions</td><td>Pie / Donut chart</td><td>"Distribution of order statuses"</td></tr>
    <tr><td>Two numeric variables</td><td>Scatter plot</td><td>"Price vs quantity sold"</td></tr>
    <tr><td>Single metric</td><td>KPI card</td><td>"Total revenue this month"</td></tr>
    <tr><td>Multiple dimensions over time</td><td>Stacked area chart</td><td>"Revenue by category over months"</td></tr>
</table>

<h2>Generating Interactive Charts</h2>
<div class="code-block">
<pre><code>import plotly.express as px
import pandas as pd

def create_chart(data: list[dict], chart_config: dict):
    '''Create a Plotly chart from query results and AI-recommended config.'''
    df = pd.DataFrame(data)
    chart_type = chart_config["chart_type"]

    chart_functions = {
        "bar": px.bar,
        "line": px.line,
        "scatter": px.scatter,
        "pie": px.pie,
        "area": px.area,
    }

    fn = chart_functions.get(chart_type, px.bar)

    kwargs = {
        "data_frame": df,
        "x": chart_config.get("x_axis"),
        "y": chart_config.get("y_axis"),
        "title": chart_config.get("title", ""),
    }
    if chart_config.get("color_by"):
        kwargs["color"] = chart_config["color_by"]

    fig = fn(**kwargs)
    return fig

# Render in Streamlit: st.plotly_chart(fig)
# Render in Gradio: gr.Plot(value=fig)</code></pre>
</div>

<h2>Building a Conversational Analytics Dashboard</h2>
<ul>
    <li><strong>Natural language input:</strong> User types a question in plain English</li>
    <li><strong>SQL generation:</strong> LLM generates and explains the SQL query</li>
    <li><strong>Execution and display:</strong> Results shown as a table with download option</li>
    <li><strong>Auto-visualization:</strong> AI recommends and generates the best chart</li>
    <li><strong>Follow-up questions:</strong> User can refine with "Break that down by region" or "Show last year too"</li>
    <li><strong>Save and share:</strong> Pin useful queries and charts to a dashboard</li>
</ul>

<h2>Common Pitfalls</h2>
<ul>
    <li><strong>Ambiguous questions:</strong> "Show me sales" could mean revenue, order count, or units sold - ask for clarification</li>
    <li><strong>Temporal ambiguity:</strong> "Last month" depends on when the query runs - use explicit date handling</li>
    <li><strong>Large result sets:</strong> Always LIMIT results and warn users about potentially expensive queries</li>
    <li><strong>Schema updates:</strong> Keep the schema context up to date when tables change</li>
</ul>


<script type="text/javascript">
</script>
</body>
</html>