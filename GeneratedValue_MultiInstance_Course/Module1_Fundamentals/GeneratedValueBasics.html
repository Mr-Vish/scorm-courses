<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
<head>
    <title>@GeneratedValue Basics</title>
    <style type="text/css" media="screen">
		@import url( ../shared/style.css );
	</style>
	<script src="../shared/scormfunctions.js" type="text/javascript"></script>
	<script src="../shared/contentfunctions.js" type="text/javascript"></script>
</head>
<body>
<h1>@GeneratedValue Basics</h1>

<h2>What is @GeneratedValue?</h2>
<p>The @GeneratedValue annotation in JPA tells the persistence provider to automatically generate primary key values for entities. This eliminates the need for manual ID assignment.</p>

<div class="code-block">
<pre><code>@Entity
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private Long id;
    
    private String username;
    private String email;
    
    // getters and setters
}</code></pre>
</div>

<h2>Why Use @GeneratedValue?</h2>
<ul>
    <li><strong>Convenience:</strong> No need to manually assign IDs</li>
    <li><strong>Uniqueness:</strong> Database ensures unique values</li>
    <li><strong>Performance:</strong> Optimized ID generation</li>
    <li><strong>Consistency:</strong> Standardized approach across entities</li>
</ul>

<h2>The Four Generation Strategies</h2>
<table>
    <tr><th>Strategy</th><th>Description</th><th>Database Support</th></tr>
    <tr>
        <td class="rowheader">AUTO</td>
        <td>Provider chooses strategy based on database</td>
        <td>All databases</td>
    </tr>
    <tr>
        <td class="rowheader">IDENTITY</td>
        <td>Uses database auto-increment column</td>
        <td>MySQL, PostgreSQL, SQL Server</td>
    </tr>
    <tr>
        <td class="rowheader">SEQUENCE</td>
        <td>Uses database sequence object</td>
        <td>PostgreSQL, Oracle, DB2</td>
    </tr>
    <tr>
        <td class="rowheader">TABLE</td>
        <td>Uses separate table to track IDs</td>
        <td>All databases</td>
    </tr>
</table>

<h2>GenerationType.AUTO</h2>
<p>The AUTO strategy delegates the choice to the JPA provider (Hibernate):</p>

<div class="code-block">
<pre><code>@Entity
public class Product {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private Long id;
}</code></pre>
</div>

<p><strong>Behavior:</strong></p>
<ul>
    <li>PostgreSQL/Oracle: Uses SEQUENCE</li>
    <li>MySQL: Uses IDENTITY</li>
    <li>Fallback: Uses TABLE</li>
</ul>

<h2>GenerationType.IDENTITY</h2>
<p>Relies on database auto-increment feature:</p>

<div class="code-block">
<pre><code>@Entity
public class Order {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
}</code></pre>
</div>

<p><strong>How it works:</strong></p>
<ol>
    <li>Entity is inserted without ID</li>
    <li>Database assigns next available ID</li>
    <li>Hibernate retrieves generated ID</li>
</ol>

<p><strong>Limitations:</strong></p>
<ul>
    <li>Cannot use batch inserts (performance impact)</li>
    <li>ID only available after database insert</li>
    <li>Not portable across all databases</li>
</ul>

<h2>GenerationType.SEQUENCE</h2>
<p>Uses database sequence objects:</p>

<div class="code-block">
<pre><code>@Entity
public class Customer {
    @Id
    @GeneratedValue(strategy = GenerationType.SEQUENCE, 
                    generator = "customer_seq")
    @SequenceGenerator(name = "customer_seq",
                      sequenceName = "customer_id_seq",
                      allocationSize = 50)
    private Long id;
}</code></pre>
</div>

<p><strong>Advantages:</strong></p>
<ul>
    <li>ID available before insert</li>
    <li>Supports batch inserts</li>
    <li>Better performance with allocationSize</li>
    <li>Portable across sequence-supporting databases</li>
</ul>

<h2>GenerationType.TABLE</h2>
<p>Uses a separate table to generate IDs:</p>

<div class="code-block">
<pre><code>@Entity
public class Invoice {
    @Id
    @GeneratedValue(strategy = GenerationType.TABLE,
                    generator = "invoice_gen")
    @TableGenerator(name = "invoice_gen",
                   table = "id_generator",
                   pkColumnName = "gen_name",
                   valueColumnName = "gen_value",
                   allocationSize = 50)
    private Long id;
}</code></pre>
</div>

<p><strong>How it works:</strong></p>
<ol>
    <li>Separate table stores current ID values</li>
    <li>Hibernate locks row, reads value, increments</li>
    <li>Uses pessimistic locking for thread safety</li>
</ol>

<p><strong>Trade-offs:</strong></p>
<ul>
    <li>Works on all databases</li>
    <li>Performance overhead from table locking</li>
    <li>Additional table to manage</li>
</ul>

<h2>Choosing the Right Strategy</h2>
<table>
    <tr><th>Use Case</th><th>Recommended Strategy</th><th>Reason</th></tr>
    <tr>
        <td class="rowheader">Single instance app</td>
        <td>IDENTITY or SEQUENCE</td>
        <td>Simple, performant</td>
    </tr>
    <tr>
        <td class="rowheader">Multi-instance app</td>
        <td>SEQUENCE or UUID</td>
        <td>Avoids collisions</td>
    </tr>
    <tr>
        <td class="rowheader">High throughput</td>
        <td>SEQUENCE with high allocationSize</td>
        <td>Minimizes database calls</td>
    </tr>
    <tr>
        <td class="rowheader">Database portability</td>
        <td>TABLE or UUID</td>
        <td>Works everywhere</td>
    </tr>
</table>

<script type="text/javascript">
</script>
</body>
</html>