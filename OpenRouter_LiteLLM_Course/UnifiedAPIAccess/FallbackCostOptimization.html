<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
<head>
    <title>Fallback and Cost Optimization</title>
    <style type="text/css" media="screen">
		@import url( ../shared/style.css );
	</style>
	<script src="../shared/scormfunctions.js" type="text/javascript"></script>
	<script src="../shared/contentfunctions.js" type="text/javascript"></script>
</head>
<body>
<h1>Fallback and Cost Optimization</h1>


<h2>Fallback Strategies</h2>
<p>When a primary model or provider is unavailable, fallbacks ensure your application stays operational. This is critical for production GenAI systems:</p>
<div class="code-block">
<pre><code>import litellm
from litellm import Router

# Configure model fallbacks
router = Router(
    model_list=[
        {
            "model_name": "primary",
            "litellm_params": {
                "model": "gpt-4o",
                "api_key": "sk-...",
            },
        },
        {
            "model_name": "primary",  # Same name = fallback
            "litellm_params": {
                "model": "claude-sonnet-4-20250514",
                "api_key": "sk-ant-...",
            },
        },
        {
            "model_name": "primary",
            "litellm_params": {
                "model": "gemini/gemini-2.0-flash",
                "api_key": "...",
            },
        },
    ],
    fallbacks=[{"primary": ["primary"]}],
    routing_strategy="simple-shuffle",  # Load balance across providers
)

# Automatically falls back if primary fails
response = router.completion(
    model="primary",
    messages=[{"role": "user", "content": "Hello"}],
)</code></pre>
</div>

<h2>Routing Strategies</h2>
<table>
    <tr><th>Strategy</th><th>Description</th><th>Best For</th></tr>
    <tr><td>simple-shuffle</td><td>Random selection across deployments</td><td>Load balancing</td></tr>
    <tr><td>least-busy</td><td>Route to deployment with lowest active requests</td><td>Even distribution</td></tr>
    <tr><td>latency-based</td><td>Route to fastest responding deployment</td><td>Latency-sensitive apps</td></tr>
    <tr><td>cost-based</td><td>Route to cheapest available deployment</td><td>Cost optimization</td></tr>
</table>

<h2>Cost Tracking and Optimization</h2>
<div class="code-block">
<pre><code>import litellm

# Enable cost tracking
litellm.success_callback = ["langfuse"]  # Log to Langfuse

# Get cost per request
response = litellm.completion(
    model="gpt-4o",
    messages=[{"role": "user", "content": "Hello"}],
)
cost = litellm.completion_cost(response)
print(f"Cost: ${cost:.6f}")

# Budget management
litellm.max_budget = 10.0  # Set a $10 budget limit
litellm.budget_duration = "daily"  # Reset daily</code></pre>
</div>

<h2>LiteLLM Proxy Server</h2>
<p>Deploy LiteLLM as a centralized proxy for your organization:</p>
<div class="code-block">
<pre><code># config.yaml for the proxy
model_list:
  - model_name: gpt-4o
    litellm_params:
      model: azure/gpt-4o
      api_base: https://myorg.openai.azure.com
      api_key: os.environ/AZURE_API_KEY

  - model_name: claude-sonnet
    litellm_params:
      model: claude-sonnet-4-20250514
      api_key: os.environ/ANTHROPIC_API_KEY

general_settings:
  master_key: sk-proxy-master-key
  database_url: postgresql://localhost/litellm

# Start the proxy
# litellm --config config.yaml --port 4000</code></pre>
</div>

<h2>Cost Optimization Tips</h2>
<ul>
    <li><strong>Model tiering:</strong> Route simple tasks to cheaper models (GPT-4o-mini, Haiku) and complex tasks to premium models</li>
    <li><strong>Caching:</strong> LiteLLM supports response caching to avoid duplicate API calls</li>
    <li><strong>Token limits:</strong> Set max_tokens per request to prevent runaway costs</li>
    <li><strong>Usage alerts:</strong> Configure alerts when spending exceeds thresholds</li>
    <li><strong>Provider arbitrage:</strong> Compare pricing across providers for the same model quality</li>
</ul>


<script type="text/javascript">
</script>
</body>
</html>