<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
<head>
    <title>3.3 Fix Broken Authentication</title>
    <style type="text/css" media="screen">
		@import url( ../shared/style.css );
	</style>
	<script src="../shared/scormfunctions.js" type="text/javascript"></script>
	<script src="../shared/contentfunctions.js" type="text/javascript"></script>
</head>
<body>
<h1>3.3 Fix Broken Authentication</h1>

<h3><strong>Python (Flask) fix — hashed passwords + secure tokens (JWT)</strong></h3>

<ol>
    <li>Use <code>werkzeug.security</code> for password hashing:
</li>
</ol>

<p>from werkzeug.security import generate_password_hash, check_password_hash</p>

<p>hashed = generate_password_hash(&#x27;password123&#x27;)  # store</p>

<p>check_password_hash(hashed, &#x27;password123&#x27;)     # verify</p>

<ol>
    <li>Use JWT (<code>pyjwt</code>) with long random secret and expiry:
</li>
</ol>

<p>import jwt, datetime</p>

<p>SECRET = &#x27;a-very-long-random-secret-key&#x27;  # store securely!</p>

<p>token = jwt.encode({&#x27;sub&#x27;: username, &#x27;exp&#x27;: datetime.datetime.utcnow()+datetime.timedelta(hours=1)}, SECRET, algorithm=&#x27;HS256&#x27;)</p>

<p># Verify token with jwt.decode(..., SECRET, algorithms=[&#x27;HS256&#x27;])</p>

<p><strong>Retest</strong></p>

<ul>
    <li>Login returns a JWT. Access <code>secure</code> with <code>Authorization: Bearer &lt;jwt&gt;</code>. Invalid or expired tokens cause 401.
</li>
</ul>

<p><strong>Common mistakes</strong></p>

<ul>
    <li>Short secrets, no expiry, or storing passwords in plaintext.
</li>
</ul>

<h3><strong>Java (Spring Boot) fix — BCrypt + JWT</strong></h3>

<ol>
    <li>Use <code>BCryptPasswordEncoder</code>:
</li>
</ol>

<p>import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;</p>

<p>BCryptPasswordEncoder enc = new BCryptPasswordEncoder();</p>

<p>String hash = enc.encode(&quot;password&quot;);</p>

<p>enc.matches(&quot;password&quot;, hash);</p>

<ol>
    <li>Use JJWT (as shown earlier) for tokens with secret keys and expiry.
</li>
</ol>

<p><strong>Retest</strong>: same as Python.</p>

<script type="text/javascript">
</script>
</body>
</html>