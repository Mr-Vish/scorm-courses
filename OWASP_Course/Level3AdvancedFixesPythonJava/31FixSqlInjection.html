<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
<head>
    <title>3.1 Fix SQL Injection</title>
    <style type="text/css" media="screen">
		@import url( ../shared/style.css );
	</style>
	<script src="../shared/scormfunctions.js" type="text/javascript"></script>
	<script src="../shared/contentfunctions.js" type="text/javascript"></script>
</head>
<body>
<h1>3.1 Fix SQL Injection</h1>

<h3><strong>Python (Flask) fix — parameterized query</strong></h3>

<p>Replace vulnerable query with parameterized one using <code>?</code> placeholders:</p>

<p># safe query</p>

<p>conn = sqlite3.connect(DB)</p>

<p>cur = conn.cursor()</p>

<p>cur.execute(&quot;SELECT id, username FROM users WHERE username = ?&quot;, (username,))</p>

<p>rows = cur.fetchall()</p>

<p><strong>Why</strong>: sqlite3 param binding prevents user input from altering SQL structure.</p>

<p><strong>Retest</strong></p>

<p>curl &quot;http://localhost:5000/user?username=%27%20OR%20%271%27=%271&quot;</p>

<p># Should return empty or only matching username, not every user</p>

<p><strong>Common mistakes</strong></p>

<ul>
    <li>Using <code>format()</code> or f-strings instead of parameters still vulnerable.
</li>
</ul>

<h3><strong>Java (Spring Boot) fix — use JdbcTemplate parameter binding or JPA</strong></h3>

<p>Replace:</p>

<p>String q = &quot;SELECT id, username FROM users WHERE username = &#x27;&quot; + username + &quot;&#x27;&quot;;</p>

<p>jdbc.queryForList(q);</p>

<p>With:</p>

<p>String q = &quot;SELECT id, username FROM users WHERE username = ?&quot;;</p>

<p>return jdbc.queryForList(q, username);</p>

<p>Or better: use <code>UserRepository extends JpaRepository</code> and <code>findByUsername</code>.</p>

<p><strong>Retest</strong>: same curl; only intended user returned.</p>

<script type="text/javascript">
</script>
</body>
</html>