<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
<head>
    <title>2.2 SQL Injection — Java (Spring Boot) vulnerable app</title>
    <style type="text/css" media="screen">
		@import url( ../shared/style.css );
	</style>
	<script src="../shared/scormfunctions.js" type="text/javascript"></script>
	<script src="../shared/contentfunctions.js" type="text/javascript"></script>
</head>
<body>
<h1>2.2 SQL Injection — Java (Spring Boot) vulnerable app</h1>

<p>This Java example uses plain JDBC and concatenated SQL to reproduce SQLi.</p>

<h3><strong>Project skeleton (Maven)</strong></h3>

<p>Key files:</p>

<p><strong><code>pom.xml</code></strong> (include Spring Boot web and JDBC, H2)</p>

<p>&lt;project ...&gt;</p>

<p>  &lt;parent&gt; ... spring-boot-starter-parent ... &lt;/parent&gt;</p>

<p>  &lt;dependencies&gt;</p>

<p>    &lt;dependency&gt;</p>

<p>      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</p>

<p>      &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</p>

<p>    &lt;/dependency&gt;</p>

<p>    &lt;dependency&gt;</p>

<p>      &lt;groupId&gt;com.h2database&lt;/groupId&gt;</p>

<p>      &lt;artifactId&gt;h2&lt;/artifactId&gt;</p>

<p>    &lt;/dependency&gt;</p>

<p>    &lt;dependency&gt;</p>

<p>      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</p>

<p>      &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;</p>

<p>    &lt;/dependency&gt;</p>

<p>  &lt;/dependencies&gt;</p>

<p>&lt;/project&gt;</p>

<div class="code-block">
<pre><code>src/main/java/com/example/vulnsql/VulnSqlApplication.java</code></pre>
</div>

<p>package com.example.vulnsql;</p>

<p>import org.springframework.boot.SpringApplication;</p>

<p>import org.springframework.boot.autoconfigure.SpringBootApplication;</p>

<p>@SpringBootApplication</p>

<p>public class VulnSqlApplication {</p>

<p>    public static void main(String[] args) { SpringApplication.run(VulnSqlApplication.class, args); }</p>

<p>}</p>

<div class="code-block">
<pre><code>src/main/resources/application.properties</code></pre>
</div>

<p>spring.datasource.url=jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1</p>

<p>spring.datasource.driver-class-name=org.h2.Driver</p>

<p>spring.datasource.username=sa</p>

<p>spring.datasource.password=</p>

<p>spring.h2.console.enabled=true</p>

<p>spring.jpa.generate-ddl=true</p>

<div class="code-block">
<pre><code>src/main/java/com/example/vulnsql/controller/UserController.java</code></pre>
</div>

<p>package com.example.vulnsql.controller;</p>

<p>import org.springframework.web.bind.annotation.*;</p>

<p>import org.springframework.jdbc.core.JdbcTemplate;</p>

<p>import org.springframework.beans.factory.annotation.Autowired;</p>

<p>import java.util.List;</p>

<p>import java.util.Map;</p>

<p>@RestController</p>

<p>public class UserController {</p>

<p>    @Autowired</p>

<p>    private JdbcTemplate jdbc;</p>

<p>    @PostConstruct</p>

<p>    public void init() {</p>

<p>        jdbc.execute(&quot;CREATE TABLE IF NOT EXISTS users (id INT AUTO_INCREMENT PRIMARY KEY, username VARCHAR(50), password VARCHAR(50))&quot;);</p>

<p>        jdbc.update(&quot;DELETE FROM users&quot;);</p>

<p>        jdbc.update(&quot;INSERT INTO users(username,password) VALUES(&#x27;alice&#x27;,&#x27;alicepass&#x27;)&quot;);</p>

<p>        jdbc.update(&quot;INSERT INTO users(username,password) VALUES(&#x27;bob&#x27;,&#x27;bobpass&#x27;)&quot;);</p>

<p>        jdbc.update(&quot;INSERT INTO users(username,password) VALUES(&#x27;admin&#x27;,&#x27;adminpass&#x27;)&quot;);</p>

<p>    }</p>

<p>    @GetMapping(&quot;/user&quot;)</p>

<p>    public List&lt;Map&lt;String,Object&gt;&gt; getUser(@RequestParam String username) {</p>

<p>        // VULNERABLE: concatenated SQL</p>

<p>        String q = &quot;SELECT id, username FROM users WHERE username = &#x27;&quot; + username + &quot;&#x27;&quot;;</p>

<p>        System.out.println(&quot;DEBUG QUERY: &quot; + q);</p>

<p>        return jdbc.queryForList(q);</p>

<p>    }</p>

<p>}</p>

<h3><strong>Run in VS Code</strong></h3>

<ol>
    <li>Open project folder. VS Code Java extension will detect Maven project.
</li>
    <li>Run: <code>mvn -DskipTests spring-boot:run</code> or run via Run/Debug.
</li>
</ol>

<h3><strong>Exploit</strong></h3>

<p>curl &quot;http://localhost:8080/user?username=%27%20OR%20%271%27=%271&quot;</p>

<p>Expected: JSON of all users.</p>

<p><strong>Common errors &amp; fixes</strong></p>

<ul>
    <li><code>NoSuchBeanDefinitionException for JdbcTemplate</code> → ensure <code>spring-boot-starter-jdbc</code> dependency and <code>application.properties</code> datasource configured.
</li>
    <li><code>ClassNotFoundException: org.h2.Driver</code> → missing H2 dependency in pom.
</li>
</ul>

<script type="text/javascript">
</script>
</body>
</html>