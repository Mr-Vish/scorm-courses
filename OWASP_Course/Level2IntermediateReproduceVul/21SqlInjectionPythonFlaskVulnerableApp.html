<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
<head>
    <title>2.1 SQL Injection — Python (Flask) vulnerable app</title>
    <style type="text/css" media="screen">
		@import url( ../shared/style.css );
	</style>
	<script src="../shared/scormfunctions.js" type="text/javascript"></script>
	<script src="../shared/contentfunctions.js" type="text/javascript"></script>
</head>
<body>
<h1>2.1 SQL Injection — Python (Flask) vulnerable app</h1>

<h3><strong>Files (single-file Flask app) — </strong><strong><code>vuln_sql_flask/app.py</code></strong></h3>

<p># app.py</p>

<p>from flask import Flask, request, jsonify</p>

<p>import sqlite3</p>

<p>app = Flask(__name__)</p>

<p>DB = &#x27;db.sqlite&#x27;</p>

<p>def init_db():</p>

<p>    conn = sqlite3.connect(DB)</p>

<p>    cur = conn.cursor()</p>

<p>    cur.execute(&quot;CREATE TABLE IF NOT EXISTS users (id INTEGER PRIMARY KEY, username TEXT, password TEXT)&quot;)</p>

<p>    # insert sample rows</p>

<p>    cur.execute(&quot;DELETE FROM users&quot;)</p>

<p>    cur.executemany(&quot;INSERT INTO users (username, password) VALUES (?, ?)&quot;, [</p>

<p>        (&#x27;alice&#x27;,&#x27;alicepass&#x27;), (&#x27;bob&#x27;,&#x27;bobpass&#x27;), (&#x27;admin&#x27;,&#x27;adminpass&#x27;)</p>

<p>    ])</p>

<p>    conn.commit()</p>

<p>    conn.close()</p>

<p>@app.route(&#x27;/user&#x27;)</p>

<p>def get_user():</p>

<p>    username = request.args.get(&#x27;username&#x27;, &#x27;&#x27;)</p>

<p>    # VULNERABLE: naive string formatting -&gt; SQL INJECTION</p>

<p>    conn = sqlite3.connect(DB)</p>

<p>    cur = conn.cursor()</p>

<p>    query = f&quot;SELECT id, username FROM users WHERE username = &#x27;{username}&#x27;&quot;</p>

<p>    print(&quot;DEBUG QUERY:&quot;, query)</p>

<p>    cur.execute(query)</p>

<p>    rows = cur.fetchall()</p>

<p>    conn.close()</p>

<p>    return jsonify([{&#x27;id&#x27;:r[0], &#x27;username&#x27;:r[1]} for r in rows])</p>

<p>if __name__ == &#x27;__main__&#x27;:</p>

<p>    init_db()</p>

<p>    app.run(host=&#x27;0.0.0.0&#x27;, port=5000, debug=True)</p>

<h3><strong>How to run in VS Code (local)</strong></h3>

<ol>
    <li>Open folder containing <code>app.py</code> in VS Code.
</li>
    <li>Create a virtualenv and install Flask:
</li>
</ol>

<p>python -m venv .venv</p>

<p>source .venv/bin/activate   # Windows: .venv\Scripts\activate</p>

<p>pip install Flask</p>

<ol>
    <li>Run:
</li>
</ol>

<p>python app.py</p>

<ol>
    <li>Visit <code>http://localhost:5000/user?username=alice</code> — returns Alice.
</li>
</ol>

<h3><strong>Exploit SQLi</strong></h3>

<ul>
    <li>Payload to return all users:
</li>
</ul>

<p>curl &quot;http://localhost:5000/user?username=%27%20OR%20%271%27=%271&quot;</p>

<p># URL-decoded: &#x27; OR &#x27;1&#x27;=&#x27;1</p>

<p>Expected: JSON array of all users.</p>

<p><strong>Why this is vulnerable</strong>: String formatting inserts user input directly into SQL query.</p>

<p><strong>Errors &amp; fixes</strong></p>

<ul>
    <li><code>sqlite3.OperationalError: no such table: users</code> → run app once to let <code>init_db()</code> run or call endpoint <code>/</code>? (init_db() runs on start).
</li>
    <li><code>Address already in use</code> → change port.
</li>
</ul>

<h3><strong>Dockerfile (optional)</strong></h3>

<div class="code-block">
<pre><code>vuln_sql_flask/Dockerfile</code></pre>
</div>

<p>FROM python:3.11-slim</p>

<p>WORKDIR /app</p>

<p>COPY app.py .</p>

<p>RUN pip install Flask</p>

<p>EXPOSE 5000</p>

<p>CMD [&quot;python&quot;,&quot;app.py&quot;]</p>

<p>Build &amp; run:</p>

<p>docker build -t vuln-sql-flask ./vuln_sql_flask</p>

<p>docker run --rm -p 5000:5000 vuln-sql-flask</p>

<script type="text/javascript">
</script>
</body>
</html>