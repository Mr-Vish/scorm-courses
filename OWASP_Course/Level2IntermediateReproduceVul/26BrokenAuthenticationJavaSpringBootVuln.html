<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
<head>
    <title>2.6 Broken Authentication — Java (Spring Boot) vulnerable app</title>
    <style type="text/css" media="screen">
		@import url( ../shared/style.css );
	</style>
	<script src="../shared/scormfunctions.js" type="text/javascript"></script>
	<script src="../shared/contentfunctions.js" type="text/javascript"></script>
</head>
<body>
<h1>2.6 Broken Authentication — Java (Spring Boot) vulnerable app</h1>

<p>A simplistic authentication endpoint using plaintext passwords and static tokens.</p>

<p><strong>Controller:</strong></p>

<p>@RestController</p>

<p>public class AuthController {</p>

<p>    private Map&lt;String,String&gt; users = new HashMap&lt;&gt;();</p>

<p>    private Map&lt;String,String&gt; tokens = new ConcurrentHashMap&lt;&gt;();</p>

<p>    @PostConstruct</p>

<p>    public void init() {</p>

<p>        users.put(&quot;admin&quot;,&quot;adminpass&quot;);</p>

<p>        users.put(&quot;alice&quot;,&quot;alicepass&quot;);</p>

<p>    }</p>

<p>    @PostMapping(&quot;/login&quot;)</p>

<p>    public Map&lt;String,String&gt; login(@RequestBody Map&lt;String,String&gt; creds) {</p>

<p>        String u = creds.get(&quot;username&quot;), p = creds.get(&quot;password&quot;);</p>

<p>        if (users.containsKey(u) &amp;&amp; users.get(u).equals(p)) {</p>

<p>            String token = Long.toHexString(System.currentTimeMillis()); // predictable!</p>

<p>            tokens.put(token,u);</p>

<p>            return Map.of(&quot;token&quot;,token);</p>

<p>        }</p>

<p>        throw new ResponseStatusException(HttpStatus.UNAUTHORIZED);</p>

<p>    }</p>

<p>    @GetMapping(&quot;/secure&quot;)</p>

<p>    public Map&lt;String,String&gt; secure(@RequestHeader(value=&quot;Authorization&quot;, required=false) String auth) {</p>

<p>        if (auth != null &amp;&amp; auth.startsWith(&quot;Bearer &quot;)) {</p>

<p>            String token = auth.substring(7);</p>

<p>            if (tokens.containsKey(token)) return Map.of(&quot;data&quot;,&quot;secret for &quot;+tokens.get(token));</p>

<p>        }</p>

<p>        throw new ResponseStatusException(HttpStatus.UNAUTHORIZED);</p>

<p>    }</p>

<p>}</p>

<p><strong>Exploit</strong>: predictable token generation based on timestamp is guessable.</p>

<script type="text/javascript">
</script>
</body>
</html>